<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î—Ä–æ–±–∏: –†–∞–∑–¥–µ–ª—è–π –∏ –í–ª–∞—Å—Ç–≤—É–π!</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', 'Marker Felt', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #ffd6e7, #c1e3ff);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            max-width: 1000px;
            background: white;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            padding: 30px;
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            background: linear-gradient(to right, #ff7eb3, #65c6ff);
            padding: 20px;
            border-radius: 20px;
            color: white;
            position: relative;
        }
        
        h1 {
            font-size: 2.3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .emoji-header {
            font-size: 3rem;
            margin: 15px 0;
        }
        
        .task-description {
            background: #f0f9ff;
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 25px;
            border: 3px dashed #65c6ff;
            text-align: center;
            font-size: 1.4rem;
            line-height: 1.6;
        }
        
        .task-description span {
            font-weight: bold;
            color: #ff6b9d;
            background: #fff0f5;
            padding: 5px 15px;
            border-radius: 15px;
            display: inline-block;
            margin: 0 5px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .visualization-area {
            display: flex;
            flex-wrap: nowrap;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
            overflow-x: auto;
            padding: 10px;
        }
        
        .object-container {
            position: relative;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 20px;
            overflow: hidden;
            border: 4px solid transparent;
            width: 240px;
            height: 280px;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0;
        }
        
        .object-container.selected {
            border-color: #ff6b9d;
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
            transform: scale(1.05);
        }
        
        .object-label {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 10px;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            display: inline-block;
        }
        
        .pizza-container {
            width: 200px;
            height: 200px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .pizza {
            width: 180px;
            height: 180px;
            background: linear-gradient(135deg, #ff9e68, #ff6b45);
            border-radius: 50%;
            border: 8px solid #f5c89d;
            position: relative;
            overflow: visible;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            transform: translateZ(0);
        }
        
        .pizza::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 50% 50%, #ffdc7a 0%, transparent 15%),
                repeating-radial-gradient(circle at 20% 30%, #ff9e68 0px, #ff9e68 2px, #ff6b45 2px, #ff6b45 4px);
            border-radius: 50%;
        }
        
        .chocolate {
            width: 200px;
            height: 130px;
            background: linear-gradient(135deg, #7b3f00, #4d2600);
            border-radius: 10px;
            position: relative;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-top: 35px;
        }
        
        .chocolate::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, transparent 49%, rgba(255, 255, 255, 0.1) 50%, transparent 51%),
                linear-gradient(0deg, transparent 49%, rgba(255, 255, 255, 0.1) 50%, transparent 51%),
                radial-gradient(circle at 30% 30%, #a05a1a 0px, #a05a1a 2px, #7b3f00 2px, #7b3f00 4px);
        }
        
        .cupcakes-container {
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, #ffd1dc, #ffb6c1);
            border-radius: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            padding: 15px;
            gap: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            position: relative;
            margin-top: 0;
        }
        
        .cupcake-box {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        
        .cupcake {
            position: relative;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
        }
        
        .cupcake-base {
            position: absolute;
            background: linear-gradient(to bottom, #f9c5bd, #f8a29a);
            border-radius: 0 0 8px 8px;
            bottom: 0;
        }
        
        .cupcake-top {
            position: absolute;
            background: linear-gradient(135deg, #ff9e68, #ff6b45);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            top: 5%;
        }
        
        .cupcake-cherry {
            position: absolute;
            z-index: 2;
            top: -10%;
        }
        
        .cupcake.selected {
            transform: scale(1.1);
            filter: drop-shadow(0 0 8px rgba(255, 107, 157, 0.8));
        }
        
        .slice {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            clip-path: polygon(50% 50%, 100% 0, 100% 100%);
            transform-origin: center;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            opacity: 1;
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: auto;
        }
        
        .slice-line {
            position: absolute;
            top: 0;
            left: 50%;
            width: 2px;
            height: 100%;
            background: white;
            transform-origin: center;
            pointer-events: none;
            transform: translateX(-1px);
        }
        
        .chocolate-piece {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.2rem;
            border: 1px solid rgba(255,255,255,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .chocolate-piece:hover, .slice:hover, .cupcake:hover {
            transform: scale(1.05);
            z-index: 1;
        }
        
        .slice.selected {
            background: linear-gradient(135deg, rgba(168, 255, 120, 0.7), rgba(120, 255, 214, 0.7));
        }
        
        .chocolate-piece.selected {
            background: linear-gradient(135deg, #a8ff78, #78ffd6);
            box-shadow: 0 0 10px rgba(168, 255, 120, 0.7) inset;
        }
        
        .cupcake.selected .cupcake-top {
            background: linear-gradient(135deg, #a8ff78, #78ffd6);
            box-shadow: 0 0 8px rgba(168, 255, 120, 0.7) inset;
        }
        
        .selected-highlight {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(168, 255, 120, 0.3);
            z-index: 10;
            pointer-events: none;
            border-radius: inherit;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
        }
        
        .control-group {
            background: #f0f9ff;
            border-radius: 18px;
            padding: 20px;
            min-width: 250px;
            text-align: center;
            border: 3px dashed #65c6ff;
        }
        
        .control-group h3 {
            margin-bottom: 15px;
            color: #ff6b9d;
        }
        
        .buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }
        
        .denominator-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }
        
        button {
            background: linear-gradient(to bottom, #65c6ff, #2a9df4);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 10px 15px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            min-width: 50px;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        button:active:not(:disabled) {
            transform: translateY(1px);
        }
        
        .feedback {
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border-radius: 18px;
            font-size: 1.4rem;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.5s ease;
        }
        
        .positive {
            background: linear-gradient(to right, #a8ff78, #78ffd6);
            border: 3px solid #4caf50;
        }
        
        .negative {
            background: linear-gradient(to right, #ff9d6f, #ff6b9d);
            border: 3px solid #f44336;
        }
        
        .neutral {
            background: linear-gradient(to right, #a8e6ff, #d4fffc);
            border: 3px solid #2196f3;
        }
        
        .progress {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #f0f9ff;
            border-radius: 18px;
            padding: 15px;
            margin-top: 20px;
            border: 3px dashed #65c6ff;
        }
        
        .xp-counter {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ff6b9d;
        }
        
        .rank-display {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ff6b9d;
            background: #fff0f5;
            padding: 5px 15px;
            border-radius: 50px;
            margin-top: 10px;
        }
        
        .badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 15px;
        }
        
        .badge {
            background: linear-gradient(to bottom, #ffdc7a, #ffb347);
            border-radius: 50px;
            padding: 6px 12px;
            font-size: 0.8rem;
            color: #7b3f00;
            display: flex;
            align-items: center;
            gap: 5px;
            opacity: 0.6;
        }
        
        .badge.earned {
            opacity: 1;
            box-shadow: 0 0 10px #ffb347;
            animation: glow 1.5s ease-in-out;
        }
        
        @keyframes glow {
            0% { box-shadow: 0 0 5px #ffb347; }
            50% { box-shadow: 0 0 20px #ffb347; }
            100% { box-shadow: 0 0 10px #ffb347; }
        }
        
        .fraction-display {
            font-size: 3rem;
            font-weight: bold;
            margin: 15px 0;
            color: #ff6b9d;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            min-height: 60px;
        }
        
        .hidden {
            display: none;
        }
        
        .instructions {
            text-align: center;
            margin: 15px 0;
            font-size: 1.2rem;
            color: #666;
        }
        
        @media (max-width: 900px) {
            .visualization-area {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .object-container {
                width: 200px;
                height: 250px;
            }
            
            .pizza-container, .cupcakes-container {
                width: 160px;
                height: 160px;
            }
            
            .pizza {
                width: 140px;
                height: 140px;
            }
            
            .chocolate {
                width: 160px;
                height: 100px;
                margin-top: 30px;
            }
        }
        
        @media (max-width: 600px) {
            .visualization-area {
                flex-direction: column;
                align-items: center;
            }
            
            .object-container {
                width: 180px;
                height: 220px;
            }
            
            .pizza-container, .cupcakes-container {
                width: 140px;
                height: 140px;
            }
            
            .pizza {
                width: 120px;
                height: 120px;
            }
            
            .chocolate {
                width: 140px;
                height: 90px;
                margin-top: 25px;
            }
            
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .denominator-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .control-group {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–î—Ä–æ–±–∏: –†–∞–∑–¥–µ–ª—è–π –∏ –í–ª–∞—Å—Ç–≤—É–π! üçïüç´üßÅ</h1>
            <div class="emoji-header">üî™ ‚úÇÔ∏è ‚ûó üß© = üìä</div>
            <p>–ò–∑—É—á–∞–π –¥—Ä–æ–±–∏, —Ä–∞–∑–¥–µ–ª—è—è –≤–∫—É—Å–Ω–æ—Å—Ç–∏ –Ω–∞ —á–∞—Å—Ç–∏!</p>
        </div>
        
        <div class="task-description">
            <p>–ó–∞–¥–∞–Ω–∏–µ: <span id="task-text">–ü–æ–∫–∞–∂–∏ –¥—Ä–æ–±—å 3/4 –Ω–∞ –ø–∏—Ü—Ü–µ</span></p>
            <div class="fraction-display">?</div>
        </div>
        
        <div class="instructions">
            <p>1. –í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∑–∞–¥–∞–Ω–∏—é üëá</p>
            <p>2. –†–∞–∑–¥–µ–ª–∏ –µ–≥–æ –Ω–∞ —á–∞—Å—Ç–∏ üî¢</p>
            <p>3. –í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–µ–π üéØ</p>
        </div>
        
        <div class="visualization-area">
            <div class="object-container" data-object="pizza">
                <div class="pizza-container">
                    <div class="pizza" id="pizza"></div>
                </div>
                <p class="object-label">üçï –ü–∏—Ü—Ü–∞</p>
            </div>
            
            <div class="object-container" data-object="chocolate">
                <div class="chocolate" id="chocolate"></div>
                <p class="object-label">üç´ –®–æ–∫–æ–ª–∞–¥–∫–∞</p>
            </div>
            
            <div class="object-container" data-object="cupcakes">
                <div class="cupcakes-container" id="cupcakes-container">
                    <div class="cupcake-box" id="cupcake-box"></div>
                </div>
                <p class="object-label">üßÅ –ö–æ—Ä–æ–±–∫–∞ –∫–µ–∫—Å–æ–≤</p>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <h3>üî™ –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞:</h3>
                <div class="buttons denominator-buttons" id="denominator-buttons">
                    <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </div>
            </div>
            
            <div class="control-group">
                <h3>üéØ –í–∑—è—Ç—å —á–∞—Å—Ç–µ–π:</h3>
                <div class="buttons" id="numerator-buttons">
                    <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </div>
            </div>
        </div>
        
        <div class="feedback neutral">
            <p>–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∑–∞–¥–∞–Ω–∏—é!</p>
            <p class="emoji">üëáüîç</p>
        </div>
        
        <div class="progress">
            <div class="xp-counter">XP: <span id="xp">0</span></div>
            <div class="rank-display">–†–∞–Ω–≥: <span id="rank">–ú–ª–∞–¥—à–∏–π –®–µ—Ñ-–ú–∞—Ç–µ–º–∞—Ç–∏–∫</span></div>
        </div>
        
        <div class="badges">
            <div class="badge">ü•á –ú–ª–∞–¥—à–∏–π –®–µ—Ñ-–ú–∞—Ç–µ–º–∞—Ç–∏–∫</div>
            <div class="badge">ü•à –®–µ—Ñ-–ú–∞—Ç–µ–º–∞—Ç–∏–∫</div>
            <div class="badge">üèÜ –ú–∞—Å—Ç–µ—Ä-–ú–∞—Ç–µ–º–∞—Ç–∏–∫</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –£—Ä–æ–≤–Ω–∏ –∏ —Ä–∞–Ω–≥–∏
            const levels = [
                { xp: 0, name: "–ù–æ–≤–∏—á–æ–∫", rank: "–ú–ª–∞–¥—à–∏–π –®–µ—Ñ-–ú–∞—Ç–µ–º–∞—Ç–∏–∫" },
                { xp: 10, name: "–£—á–µ–Ω–∏–∫", rank: "–®–µ—Ñ-–ú–∞—Ç–µ–º–∞—Ç–∏–∫" },
                { xp: 25, name: "–ó–Ω–∞—Ç–æ–∫", rank: "–ú–∞—Å—Ç–µ—Ä-–ú–∞—Ç–µ–º–∞—Ç–∏–∫" },
                { xp: 45, name: "–≠–∫—Å–ø–µ—Ä—Ç", rank: "–ì–µ–Ω–∏–π –î—Ä–æ–±–µ–π" },
                { xp: 70, name: "–ì—É—Ä—É", rank: "–í–µ–ª–∏–∫–∏–π –ú–∞—Ç–µ–º–∞—Ç–∏–∫" }
            ];
            
            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            const state = {
                currentObject: null,
                denominator: null,
                numerator: null,
                currentFraction: null,
                currentTask: null,
                xp: 0,
                completedTasks: 0,
                tasks: [],
                currentTaskIndex: 0,
                selectedObject: null
            };
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –ø–æ —Ç–∏–ø–∞–º
            function generateUniqueTasks() {
                const tasks = [];
                const fractions = new Set();
                
                // –°–æ–∑–¥–∞–µ–º –ø–æ 2 –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
                const objectTypes = ['pizza', 'chocolate', 'cupcakes'];
                const typeCount = { pizza: 0, chocolate: 0, cupcakes: 0 };
                
                while (tasks.length < 6) {
                    // –í—ã–±–∏—Ä–∞–µ–º —Ç–∏–ø, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –º–µ–Ω—å—à–µ –∑–∞–¥–∞–Ω–∏–π
                    let availableTypes = objectTypes.filter(type => typeCount[type] < 2);
                    if (availableTypes.length === 0) availableTypes = objectTypes;
                    
                    const object = availableTypes[Math.floor(Math.random() * availableTypes.length)];
                    
                    // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞ –ø–æ–¥–±–∏—Ä–∞–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –¥—Ä–æ–±–∏
                    let numerator, denominator;
                    
                    if (object === 'pizza') {
                        // –î–ª—è –ø–∏—Ü—Ü—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ 4, 6, 8 –∏ 10 —á–∞—Å—Ç–µ–π
                        const pizzaDenominators = [4, 6, 8, 10];
                        denominator = pizzaDenominators[Math.floor(Math.random() * pizzaDenominators.length)];
                        numerator = Math.floor(Math.random() * (denominator - 1)) + 1;
                    } else if (object === 'chocolate') {
                        denominator = [2, 4, 5, 8, 10][Math.floor(Math.random() * 5)];
                        numerator = Math.floor(Math.random() * (denominator - 1)) + 1;
                    } else { // cupcakes
                        denominator = [2, 3, 4, 5, 6, 10][Math.floor(Math.random() * 6)];
                        numerator = Math.floor(Math.random() * (denominator - 1)) + 1;
                    }
                    
                    const fractionStr = `${numerator}/${denominator}`;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –¥—Ä–æ–±–∏
                    if (!fractions.has(fractionStr)) {
                        fractions.add(fractionStr);
                        tasks.push({
                            object: object,
                            fraction: [numerator, denominator],
                            text: `–ü–æ–∫–∞–∂–∏ –¥—Ä–æ–±—å ${fractionStr} –Ω–∞ ${object === 'pizza' ? '–ø–∏—Ü—Ü–µ' : object === 'chocolate' ? '—à–æ–∫–æ–ª–∞–¥–∫–µ' : '–∫–µ–∫—Å–∞—Ö'}`
                        });
                        typeCount[object]++;
                    }
                }
                
                return tasks;
            }
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
            const elements = {
                pizza: document.getElementById('pizza'),
                chocolate: document.getElementById('chocolate'),
                cupcakeBox: document.getElementById('cupcake-box'),
                cupcakesContainer: document.getElementById('cupcakes-container'),
                taskText: document.getElementById('task-text'),
                feedback: document.querySelector('.feedback'),
                xpDisplay: document.getElementById('xp'),
                rankDisplay: document.getElementById('rank'),
                fractionDisplay: document.querySelector('.fraction-display'),
                objectContainers: document.querySelectorAll('.object-container'),
                denominatorButtons: document.getElementById('denominator-buttons'),
                numeratorButtons: document.getElementById('numerator-buttons')
            };
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            function init() {
                // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è (2-10)
                for (let i = 2; i <= 10; i++) {
                    const button = document.createElement('button');
                    button.textContent = i;
                    button.dataset.parts = i;
                    button.disabled = true;
                    elements.denominatorButtons.appendChild(button);
                }
                
                // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ —á–∏—Å–ª–∏—Ç–µ–ª—è (1-10)
                for (let i = 1; i <= 10; i++) {
                    const button = document.createElement('button');
                    button.textContent = i;
                    button.id = `take-${i}`;
                    button.disabled = true;
                    elements.numeratorButtons.appendChild(button);
                }
                
                state.tasks = generateUniqueTasks();
                loadTask();
                setupEventListeners();
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏—è
            function loadTask() {
                state.currentTask = state.tasks[state.currentTaskIndex];
                state.currentObject = state.currentTask.object;
                state.currentFraction = state.currentTask.fraction;
                state.denominator = null;
                state.numerator = null;
                state.selectedObject = null;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                elements.taskText.textContent = state.currentTask.text;
                elements.fractionDisplay.textContent = "?";
                elements.feedback.className = "feedback neutral";
                elements.feedback.innerHTML = `<p>–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∑–∞–¥–∞–Ω–∏—é!</p><p class="emoji">üëáüîç</p>`;
                
                // –û—á–∏—Å—Ç–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
                clearVisualization();
                
                // –°–±—Ä–æ—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
                elements.objectContainers.forEach(container => {
                    container.classList.remove('selected');
                });
                
                // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫
                disableDenominatorButtons();
                disableNumeratorButtons();
            }
            
            // –û—á–∏—Å—Ç–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
            function clearVisualization() {
                // –û—á–∏—Å—Ç–∫–∞ –ø–∏—Ü—Ü—ã
                const pizzaSlices = document.querySelectorAll('.slice, .slice-line, .selected-highlight');
                pizzaSlices.forEach(slice => slice.remove());
                
                // –û—á–∏—Å—Ç–∫–∞ —à–æ–∫–æ–ª–∞–¥–∫–∏
                const chocolatePieces = document.querySelectorAll('.chocolate-piece, .selected-highlight');
                chocolatePieces.forEach(piece => piece.remove());
                
                // –û—á–∏—Å—Ç–∫–∞ –∫–µ–∫—Å–æ–≤
                elements.cupcakeBox.innerHTML = '';
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∫–µ–∫—Å–æ–≤ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
            function createCupcakes(count) {
                elements.cupcakeBox.innerHTML = '';
                const container = elements.cupcakesContainer;
                
                // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                const containerWidth = container.offsetWidth;
                const containerHeight = container.offsetHeight;
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
                let columns, rows;
                let gap = 8;
                
                // –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å–µ—Ç–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–µ–∫—Å–æ–≤
                if (count === 1) {
                    columns = 1;
                    rows = 1;
                } else if (count === 2) {
                    columns = 2;
                    rows = 1;
                    gap = 15; // –ë–æ–ª—å—à–µ –∑–∞–∑–æ—Ä –¥–ª—è 2 –∫–µ–∫—Å–æ–≤
                } else if (count === 3) {
                    columns = 2;
                    rows = 2;
                    gap = 8;
                } else if (count === 4) {
                    columns = 2;
                    rows = 2;
                    gap = 10;
                } else if (count === 5 || count === 6) {
                    columns = 3;
                    rows = 2;
                    gap = 6;
                } else {
                    columns = Math.min(4, count);
                    rows = Math.ceil(count / columns);
                    gap = 5;
                }
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–µ–∫—Å–æ–≤
                const cupcakeWidth = Math.min(
                    (containerWidth - (columns - 1) * gap) / columns,
                    (containerHeight - (rows - 1) * gap) / rows / 1.4
                );
                
                const cupcakeHeight = cupcakeWidth * 1.4;
                
                // –°–æ–∑–¥–∞–µ–º –∫–µ–∫—Å—ã
                for (let i = 0; i < count; i++) {
                    const cupcake = document.createElement('div');
                    cupcake.className = 'cupcake';
                    cupcake.style.width = `${cupcakeWidth}px`;
                    cupcake.style.height = `${cupcakeHeight}px`;
                    
                    // –û—Å–Ω–æ–≤–∞ –∫–µ–∫—Å–∞
                    const base = document.createElement('div');
                    base.className = 'cupcake-base';
                    base.style.width = `${cupcakeWidth * 0.8}px`;
                    base.style.height = `${cupcakeHeight * 0.35}px`;
                    
                    // –í–µ—Ä—Ö—É—à–∫–∞ –∫–µ–∫—Å–∞
                    const top = document.createElement('div');
                    top.className = 'cupcake-top';
                    top.style.width = `${cupcakeWidth * 0.7}px`;
                    top.style.height = `${cupcakeHeight * 0.35}px`;
                    
                    // –í–∏—à–µ–Ω–∫–∞
                    const cherry = document.createElement('div');
                    cherry.className = 'cupcake-cherry';
                    cherry.textContent = 'üçí';
                    cherry.style.fontSize = `${Math.max(10, cupcakeWidth * 0.15)}px`;
                    top.appendChild(cherry);
                    
                    cupcake.appendChild(top);
                    cupcake.appendChild(base);
                    cupcake.dataset.index = i;
                    cupcake.addEventListener('click', () => selectCupcake(cupcake));
                    
                    elements.cupcakeBox.appendChild(cupcake);
                }
                
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–µ–∫—Å—ã –¥–ª—è –Ω–µ—á–µ—Ç–Ω—ã—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤
                if (count === 3 || count === 5) {
                    elements.cupcakeBox.style.justifyContent = 'center';
                } else {
                    elements.cupcakeBox.style.justifyContent = 'space-around';
                }
            }
            
            // –í—ã–±–æ—Ä –∫–µ–∫—Å–∞
            function selectCupcake(cupcake) {
                if (state.currentObject !== 'cupcakes' || !state.denominator) return;
                
                cupcake.classList.toggle('selected');
                const selected = document.querySelectorAll('.cupcake.selected').length;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–∏—Ç–µ–ª—è
                state.numerator = selected;
                updateFractionDisplay();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏—è
                checkSolution();
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            function setupEventListeners() {
                // –í—ã–±–æ—Ä –æ–±—ä–µ–∫—Ç–∞
                elements.objectContainers.forEach(container => {
                    container.addEventListener('click', () => {
                        const objectType = container.dataset.object;
                        
                        // –°–±—Ä–æ—Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤—ã–±–æ—Ä–∞
                        elements.objectContainers.forEach(c => c.classList.remove('selected'));
                        
                        // –í—ã–±–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞
                        container.classList.add('selected');
                        state.selectedObject = objectType;
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–∞ –æ–±—ä–µ–∫—Ç–∞
                        if (state.selectedObject === state.currentObject) {
                            elements.feedback.className = "feedback positive";
                            elements.feedback.innerHTML = `<p>–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –¢—ã –≤—ã–±—Ä–∞–ª ${getObjectName()} üéâ</p><p>–¢–µ–ø–µ—Ä—å —Ä–∞–∑–¥–µ–ª–∏ –µ–≥–æ –Ω–∞ —á–∞—Å—Ç–∏!</p>`;
                            enableDenominatorButtons();
                        } else {
                            elements.feedback.className = "feedback negative";
                            elements.feedback.innerHTML = `<p>–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑! ü§î</p><p>–í –∑–∞–¥–∞–Ω–∏–∏ —É–∫–∞–∑–∞–Ω –¥—Ä—É–≥–æ–π –ø—Ä–µ–¥–º–µ—Ç.</p>`;
                            disableDenominatorButtons();
                        }
                    });
                });
                
                // –ö–Ω–æ–ø–∫–∏ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è
                elements.denominatorButtons.querySelectorAll('button').forEach(button => {
                    button.addEventListener('click', () => {
                        const denominator = parseInt(button.dataset.parts);
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è
                        if (denominator === state.currentFraction[1]) {
                            setDenominator(denominator);
                        } else {
                            elements.feedback.className = "feedback negative";
                            elements.feedback.innerHTML = `<p>–ü–æ—á—Ç–∏! ü§î</p><p>–ü–æ–ø—Ä–æ–±—É–π –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.</p>`;
                        }
                    });
                });
                
                // –ö–Ω–æ–ø–∫–∏ —á–∏—Å–ª–∏—Ç–µ–ª—è
                elements.numeratorButtons.querySelectorAll('button').forEach(button => {
                    button.addEventListener('click', () => {
                        const numerator = parseInt(button.textContent);
                        setNumerator(numerator);
                    });
                });
            }
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è
            function setDenominator(denominator) {
                state.denominator = denominator;
                state.numerator = null; // –°–±—Ä–æ—Å —á–∏—Å–ª–∏—Ç–µ–ª—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                updateFractionDisplay();
                
                // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
                prepareNumeratorButtons();
                
                // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
                visualizeDivision();
                
                // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —á–∏—Å–ª–∏—Ç–µ–ª—è
                enableNumeratorButtons();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
                elements.feedback.className = "feedback neutral";
                elements.feedback.innerHTML = `<p>–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–µ–π.</p>`;
            }
            
            // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
            function visualizeDivision() {
                if (state.currentObject === 'pizza') {
                    // –î–ª—è –ø–∏—Ü—Ü—ã - —Å–æ–∑–¥–∞–µ–º —Å—Ä–µ–∑—ã
                    createPizzaSlices();
                } else if (state.currentObject === 'chocolate') {
                    // –î–ª—è —à–æ–∫–æ–ª–∞–¥–∫–∏ - —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ —á–∞—Å—Ç–∏
                    divideChocolate();
                } else if (state.currentObject === 'cupcakes') {
                    // –î–ª—è –∫–µ–∫—Å–æ–≤ - –ø–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                    createCupcakes(state.denominator);
                }
            }
            
            // –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —à–æ–∫–æ–ª–∞–¥–∫–∏ –Ω–∞ —Ä–∞–≤–Ω—ã–µ —á–∞—Å—Ç–∏
            function divideChocolate() {
                elements.chocolate.innerHTML = '';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å–µ—Ç–∫—É
                let rows = 1;
                let cols = state.denominator;
                
                // –î–ª—è –±–æ–ª—å—à–∏—Ö –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ–π –¥–µ–ª–∞–µ–º 2 —Ä—è–¥–∞
                if (state.denominator > 5) {
                    rows = 2;
                    cols = Math.ceil(state.denominator / 2);
                }
                
                // –°–æ–∑–¥–∞–µ–º —á–∞—Å—Ç–∏
                const width = 100 / cols;
                const height = 100 / rows;
                
                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < cols; col++) {
                        const index = row * cols + col;
                        if (index >= state.denominator) break;
                        
                        const piece = document.createElement('div');
                        piece.className = 'chocolate-piece';
                        piece.style.width = `${width}%`;
                        piece.style.height = `${height}%`;
                        piece.style.left = `${col * width}%`;
                        piece.style.top = `${row * height}%`;
                        piece.textContent = 'üç´';
                        piece.dataset.index = index;
                        piece.addEventListener('click', () => selectChocolatePiece(piece));
                        elements.chocolate.appendChild(piece);
                    }
                }
            }
            
            // –í—ã–±–æ—Ä –∫—É—Å–æ—á–∫–∞ —à–æ–∫–æ–ª–∞–¥–∞
            function selectChocolatePiece(piece) {
                if (state.currentObject !== 'chocolate' || !state.denominator) return;
                
                piece.classList.toggle('selected');
                const selected = document.querySelectorAll('.chocolate-piece.selected').length;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–∏—Ç–µ–ª—è
                state.numerator = selected;
                updateFractionDisplay();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏—è
                checkSolution();
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ä–µ–∑–æ–≤ –ø–∏—Ü—Ü—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è 4, 6, 8, 10 —á–∞—Å—Ç–µ–π)
            function createPizzaSlices() {
                // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å—Ä–µ–∑–æ–≤
                const pizzaSlices = document.querySelectorAll('.slice, .slice-line');
                pizzaSlices.forEach(slice => slice.remove());
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å –¥–æ–ø—É—Å—Ç–∏–º –¥–ª—è –ø–∏—Ü—Ü—ã
                const validDenominators = [4, 6, 8, 10];
                if (!validDenominators.includes(state.denominator)) return;
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–Ω–∏–π —Ä–∞–∑—Ä–µ–∑–∞
                for (let i = 0; i < state.denominator; i++) {
                    const sliceLine = document.createElement('div');
                    sliceLine.className = 'slice-line';
                    sliceLine.style.transform = `rotate(${i * (360 / state.denominator)}deg)`;
                    elements.pizza.appendChild(sliceLine);
                }
                
                // –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∫—Ç–æ—Ä–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞
                for (let i = 0; i < state.denominator; i++) {
                    const slice = document.createElement('div');
                    slice.className = 'slice';
                    slice.dataset.index = i;
                    
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É–≥–ª—ã –¥–ª—è —Å–µ–∫—Ç–æ—Ä–∞
                    const startAngle = i * (360 / state.denominator);
                    const endAngle = (i + 1) * (360 / state.denominator);
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —É–≥–ª–æ–≤ –≤ —Ä–∞–¥–∏–∞–Ω—ã
                    const startRad = (startAngle - 90) * Math.PI / 180;
                    const endRad = (endAngle - 90) * Math.PI / 180;
                    
                    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–µ–∫ –Ω–∞ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏
                    const center = 50;
                    const radius = 50;
                    
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–µ–∫
                    const x1 = center + radius * Math.cos(startRad);
                    const y1 = center + radius * Math.sin(startRad);
                    const x2 = center + radius * Math.cos(endRad);
                    const y2 = center + radius * Math.sin(endRad);
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º clip-path
                    slice.style.clipPath = `polygon(50% 50%, ${x1}% ${y1}%, ${x2}% ${y2}%)`;
                    slice.addEventListener('click', () => selectPizzaSlice(slice));
                    elements.pizza.appendChild(slice);
                }
            }
            
            // –í—ã–±–æ—Ä —Å—Ä–µ–∑–∞ –ø–∏—Ü—Ü—ã
            function selectPizzaSlice(slice) {
                if (state.currentObject !== 'pizza' || !state.denominator) return;
                
                slice.classList.toggle('selected');
                const selected = document.querySelectorAll('.slice.selected').length;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–∏—Ç–µ–ª—è
                state.numerator = selected;
                updateFractionDisplay();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏—è
                checkSolution();
            }
            
            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫ —á–∏—Å–ª–∏—Ç–µ–ª—è
            function prepareNumeratorButtons() {
                const buttons = elements.numeratorButtons.querySelectorAll('button');
                
                buttons.forEach(button => {
                    const numerator = parseInt(button.textContent);
                    
                    if (numerator <= state.denominator) {
                        button.classList.remove('hidden');
                        button.disabled = false;
                    } else {
                        button.classList.add('hidden');
                    }
                });
            }
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–∏—Å–ª–∏—Ç–µ–ª—è
            function setNumerator(numerator) {
                state.numerator = numerator;
                updateFractionDisplay();
                
                // –í—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —á–∞—Å—Ç–µ–π
                highlightSelectedParts();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏—è
                checkSolution();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥—Ä–æ–±–∏
            function updateFractionDisplay() {
                if (state.denominator && state.numerator !== null) {
                    elements.fractionDisplay.textContent = `${state.numerator}/${state.denominator}`;
                } else if (state.denominator) {
                    elements.fractionDisplay.textContent = `?/${state.denominator}`;
                } else {
                    elements.fractionDisplay.textContent = "?";
                }
            }
            
            // –í—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —á–∞—Å—Ç–µ–π –Ω–∞ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–∞—Ö
            function highlightSelectedParts() {
                if (state.numerator === null || state.numerator === 0) return;
                
                // –î–ª—è –ø–∏—Ü—Ü—ã
                if (state.currentObject === 'pizza') {
                    const slices = document.querySelectorAll('.slice');
                    slices.forEach((slice, index) => {
                        if (index < state.numerator) {
                            slice.classList.add('selected');
                        } else {
                            slice.classList.remove('selected');
                        }
                    });
                }
                
                // –î–ª—è —à–æ–∫–æ–ª–∞–¥–∫–∏
                else if (state.currentObject === 'chocolate') {
                    const pieces = document.querySelectorAll('.chocolate-piece');
                    pieces.forEach((piece, index) => {
                        if (index < state.numerator) {
                            piece.classList.add('selected');
                        } else {
                            piece.classList.remove('selected');
                        }
                    });
                }
                
                // –î–ª—è –∫–µ–∫—Å–æ–≤
                else if (state.currentObject === 'cupcakes') {
                    const cupcakes = document.querySelectorAll('.cupcake');
                    cupcakes.forEach((cupcake, index) => {
                        if (index < state.numerator) {
                            cupcake.classList.add('selected');
                        } else {
                            cupcake.classList.remove('selected');
                        }
                    });
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏—è
            function checkSolution() {
                if (state.numerator === null || !state.denominator) return;
                
                const correctNumerator = state.currentFraction[0];
                const correctDenominator = state.currentFraction[1];
                
                if (state.numerator === correctNumerator && state.denominator === correctDenominator) {
                    // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                    elements.feedback.className = "feedback positive";
                    elements.feedback.innerHTML = `
                        <p>–û—Ç–ª–∏—á–Ω–æ! –≠—Ç–æ ${state.numerator}/${state.denominator} ${getObjectName()}! üéâ</p>
                        <p>–¢—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª +5 XP! ‚≠ê</p>
                    `;
                    
                    // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ XP
                    state.xp += 5;
                    state.completedTasks++;
                    elements.xpDisplay.textContent = state.xp;
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∏ —Ä–∞–Ω–≥–∞
                    updateLevel();
                    
                    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∑–∞–¥–∞–Ω–∏—é —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        state.currentTaskIndex = (state.currentTaskIndex + 1) % state.tasks.length;
                        
                        // –ï—Å–ª–∏ –ø—Ä–æ—à–ª–∏ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ
                        if (state.currentTaskIndex === 0) {
                            state.tasks = generateUniqueTasks();
                        }
                        
                        loadTask();
                    }, 2000);
                } else {
                    // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                    elements.feedback.className = "feedback negative";
                    
                    if (state.numerator > correctNumerator) {
                        elements.feedback.innerHTML = `
                            <p>–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ! ü§î</p>
                            <p>–ü–æ–ø—Ä–æ–±—É–π –≤—ã–±—Ä–∞—Ç—å –º–µ–Ω—å—à–µ —á–∞—Å—Ç–µ–π.</p>
                        `;
                    } else if (state.numerator < correctNumerator) {
                        elements.feedback.innerHTML = `
                            <p>–ú–∞–ª–æ —á–∞—Å—Ç–µ–π! ü§î</p>
                            <p>–ü–æ–ø—Ä–æ–±—É–π –≤—ã–±—Ä–∞—Ç—å –±–æ–ª—å—à–µ —á–∞—Å—Ç–µ–π.</p>
                        `;
                    } else {
                        elements.feedback.innerHTML = `
                            <p>–ü–æ—á—Ç–∏ –ø–æ–ª—É—á–∏–ª–æ—Å—å! ü§î</p>
                            <p>–ü—Ä–æ–≤–µ—Ä—å, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ç—ã —Ä–∞–∑–¥–µ–ª–∏–ª –ø—Ä–µ–¥–º–µ—Ç.</p>
                        `;
                    }
                }
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞
            function getObjectName() {
                switch (state.currentObject) {
                    case 'pizza': return '–ø–∏—Ü—Ü—É';
                    case 'chocolate': return '—à–æ–∫–æ–ª–∞–¥–∫—É';
                    case 'cupcakes': return '–∫–µ–∫—Å—ã';
                    default: return '';
                }
            }
            
            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è
            function enableDenominatorButtons() {
                elements.denominatorButtons.querySelectorAll('button').forEach(btn => {
                    btn.disabled = false;
                });
            }
            
            // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è
            function disableDenominatorButtons() {
                elements.denominatorButtons.querySelectorAll('button').forEach(btn => {
                    btn.disabled = true;
                });
            }
            
            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —á–∏—Å–ª–∏—Ç–µ–ª—è
            function enableNumeratorButtons() {
                elements.numeratorButtons.querySelectorAll('button').forEach(btn => {
                    if (!btn.classList.contains('hidden')) {
                        btn.disabled = false;
                    }
                });
            }
            
            // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫ —á–∏—Å–ª–∏—Ç–µ–ª—è
            function disableNumeratorButtons() {
                elements.numeratorButtons.querySelectorAll('button').forEach(btn => {
                    btn.disabled = true;
                });
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            function updateLevel() {
                let currentLevel = levels[0];
                
                // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å
                for (let i = levels.length - 1; i >= 0; i--) {
                    if (state.xp >= levels[i].xp) {
                        currentLevel = levels[i];
                        break;
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                elements.rankDisplay.textContent = currentLevel.rank;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂–∏
                const badges = document.querySelectorAll('.badge');
                badges.forEach((badge, index) => {
                    badge.classList.remove('earned');
                    if (index < levels.indexOf(currentLevel)) {
                        badge.classList.add('earned');
                    }
                });
            }
            
            // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            init();
        });
    </script>
</body>
</html>